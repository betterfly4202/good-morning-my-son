# 육아 전문가 답변 엔진 아키텍처

## 프로젝트 목적

특정 육아 유튜버(=육아 전문가)의 콘텐츠만을 지식 소스로 사용하여, 해당 전문가가 직접 답변한 것처럼 일관된 답변을 생성하는 엔진 구축.

### 핵심 철학

> **AI가 똑똑해 보이는 것보다, 정직하게 말 안 하는 것이 더 중요하다**

- 근거가 없는 경우 추측하지 않고 명확히 답변 보류
- 출처 기반 답변 엔진 (법률, 의료, 교육, 코칭 등으로 확장 가능)

---

## 핵심 요구사항

### 1. 단일 전문가 기반 답변
- 유튜버 1명만 선택 (v1: 하정훈 선생님)
- 답변 톤, 관점, 기준은 해당 유튜버로 한정
- 일반 육아 상식 혼합 금지

### 2. 근거 없는 답변 금지
- 스크립트 데이터에 명시적 또는 충분히 유사한 내용이 없으면 답변 보류
- 반드시 "모른다 / 언급된 적 없다"는 취지의 응답 반환

---

## 시스템 전체 구조

```
[사용자 질문]
      ↓
[질문 정제 / 의도 파악]
      ↓
[전문가 스크립트 검색]
      ↓
[Claude: 관련성 판단]
   ↙            ↘
[충분]        [부족]
   ↓            ↓
[답변 생성]  [답변 보류]
   ↓            ↓
"하정훈 선생님은..."  "관련 콘텐츠를 찾지 못했습니다"
```

---

## 데이터 파이프라인

### 데이터 흐름

```
YouTube 영상
    ↓ (yt-dlp)
자막 JSON 파일
    ↓ (청크 분할)
검색 가능한 청크
    ↓ (키워드 매칭)
후보 청크들
    ↓ (Claude API)
답변 또는 보류
```

### 스크립트 수집
- 유튜브 영상 자막 (자동 생성 포함)
- Q&A, 라이브, 강의형 영상 우선

**처리 단계**
1. 영상 ID 수집
2. 자막 추출
3. 광고/인사/반복 멘트 제거
4. 문단 단위 분리

### 스크립트 정제
각 문단에 메타데이터 부여:
- 영상 제목
- 주제 태그
- 아이 연령대 (명시된 경우만, 추측 금지)

---

## 질문 처리 로직

### 질문 정제
- 감정 표현 제거
- 핵심 행동 / 상황 키워드 추출
- 중립적 문장으로 변환

### 사용자 질문 예시
- 아이가 물건을 던질 때 어떻게 해야 하나요?
- 24개월 아이가 떼쓰는 이유는 뭔가요?

---

## 유사도 판단 로직

### 원칙
- 조금 비슷해 보인다는 이유로 답변하지 않음
- 전문가가 직접 다룬 개념·행동·원칙만 허용

### 판단 기준
- 키워드 일치
- 의미 유사도
- 행동 단위 일치 여부

### 최소 기준
- 관련 스크립트 N개 이상
- 동일 행동 또는 상황 명시적 언급
- **기준 미달 시 무조건 답변 보류**

### Claude 역할
- 임베딩 대신 LLM이 맥락 이해
- 프로젝트 철학에 부합하는 관련성 판단

---

## 답변 생성 규칙

### 답변 구성
1. 전문가 관점 요약
2. 발언 핵심 재구성
3. 반복적으로 강조된 원칙 포함

### 말투 규칙
- "일반적으로는..." 사용 금지
- "○○님은 이렇게 말합니다" 형식 사용

### 답변 보류 시 출력
- "이 질문과 직접적으로 연결되는 ○○님의 콘텐츠를 찾지 못했습니다."
- "추측으로 답변하는 것은 적절하지 않아 답변을 보류합니다."

---

## MVP 범위 (v1)

### 포함
- 유튜버 1명 (하정훈 선생님)
- 영상 50~100개 스크립트
- 답변 생성 또는 보류 판정

### 제외
- 다중 전문가
- 일반 상식 보완
- 감정 공감형 응답

---

## 디렉토리 구조

```
src/main/kotlin/com/goodmorning/
├── controller/   # REST API 컨트롤러
├── subtitle/     # 자막 수집/파싱
├── embedding/    # 임베딩 생성
├── vectordb/     # 벡터 저장소
└── rag/          # RAG 파이프라인
```

---

## 확장 가능성

이 출처 기반 답변 엔진은 육아 도메인에 국한되지 않으며, 다음 영역으로 확장 가능:
- 법률 상담
- 의료 정보
- 교육 콘텐츠
- 코칭/멘토링

---

## 구현 체크리스트

### Phase 1: 데이터 파이프라인 (자막 수집)
- [x] yt-dlp 기반 자막 추출 (`subtitle/client/`)
- [x] 다중 포맷 파싱 (JSON3, VTT, SRT) (`subtitle/parser/`)
- [x] 자막 수집 API (`GET /api/subtitles/{videoId}`)
- [ ] 광고/인사/반복 멘트 필터링
- [ ] 문단 단위 청크 분할
- [ ] 메타데이터 부여 (영상 제목, 주제 태그, 연령대)

### Phase 2: 청크 저장소
- [ ] 청크 데이터 모델 정의
- [ ] 파일 기반 청크 저장소 구현
- [ ] 청크 인덱싱 (키워드 기반)

### Phase 3: 질문 처리
- [ ] 질문 정제 모듈 (감정 표현 제거, 중립화)
- [ ] 핵심 키워드 추출

### Phase 4: 검색 및 관련성 판단
- [ ] 키워드 기반 후보 청크 검색
- [ ] Claude API 연동
- [ ] 관련성 판단 로직 (충분/부족 판정)

### Phase 5: 답변 생성
- [ ] 답변 생성 로직 ("○○님은 이렇게 말합니다" 형식)
- [ ] 답변 보류 처리 ("콘텐츠를 찾지 못했습니다")
- [ ] 질문 답변 API (`POST /api/ask`)

### Phase 6: 통합 및 검증
- [ ] E2E 테스트
- [ ] 답변 품질 검증 (근거 없는 답변 방지 확인)

---

## 진척 현황

| Phase | 상태 | 비고 |
|-------|------|------|
| 1. 데이터 파이프라인 | 🔄 60% | 자막 수집 완료, 청크 분할 필요 |
| 2. 청크 저장소 | ⬜ 0% | |
| 3. 질문 처리 | ⬜ 0% | |
| 4. 검색/관련성 판단 | ⬜ 0% | |
| 5. 답변 생성 | ⬜ 0% | |
| 6. 통합/검증 | ⬜ 0% | |

**전체 진척률: ~20%**

상태: ⬜ 대기 / 🔄 진행중 / ✅ 완료
